<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · AdvancedPS</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">AdvancedPS</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Samplers"><span>Samplers</span></a></li><li><a class="tocitem" href="#Resampling"><span>Resampling</span></a></li><li><a class="tocitem" href="#RNG"><span>RNG</span></a></li><li><a class="tocitem" href="#Internals"><span>Internals</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example/">Examples</a></li><li><a class="tocitem" href="../examples/gaussian-process/">Gaussian Process State-Space Model (GP-SSM)</a></li><li><a class="tocitem" href="../examples/gaussian-ssm/">Particle Gibbs for Gaussian state-space model</a></li><li><a class="tocitem" href="../examples/levy-ssm/">Levy-SSM latent state inference</a></li><li><a class="tocitem" href="../examples/particle-gibbs/">Particle Gibbs for non-linear models</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/TuringLang/AdvancedPS.jl/blob/master/docs/src/api.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><h2 id="Samplers"><a class="docs-heading-anchor" href="#Samplers">Samplers</a><a id="Samplers-1"></a><a class="docs-heading-anchor-permalink" href="#Samplers" title="Permalink"></a></h2><p>AdvancedPS introduces a few samplers extending <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC</a>. The <code>sample</code> method expects a custom type that subtypes <code>AbstractMCMC.AbstractModel</code>. The available samplers are listed below:</p><h3 id="SMC"><a class="docs-heading-anchor" href="#SMC">SMC</a><a id="SMC-1"></a><a class="docs-heading-anchor-permalink" href="#SMC" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.SMC" href="#AdvancedPS.SMC"><code>AdvancedPS.SMC</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SMC(n[, resampler = ResampleWithESSThreshold()])
SMC(n, [resampler = resample_systematic, ]threshold)</code></pre><p>Create a sequential Monte Carlo (SMC) sampler with <code>n</code> particles.</p><p>If the algorithm for the resampling step is not specified explicitly, systematic resampling is performed if the estimated effective sample size per particle drops below 0.5.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/smc.jl#L6-L14">source</a></section></article><p>The SMC sampler populates a set of particles in a <a href="#AdvancedPS.ParticleContainer"><code>AdvancedPS.ParticleContainer</code></a> and performs a <a href="#AdvancedPS.sweep!"><code>AdvancedPS.sweep!</code></a> which  propagates the particles and provides an estimation of the log-evidence</p><pre><code class="language-julia hljs">sampler = SMC(nparticles) 
chains = sample(model, sampler)</code></pre><h3 id="Particle-Gibbs"><a class="docs-heading-anchor" href="#Particle-Gibbs">Particle Gibbs</a><a id="Particle-Gibbs-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-Gibbs" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.PG" href="#AdvancedPS.PG"><code>AdvancedPS.PG</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PG(n, [resampler = ResampleWithESSThreshold()])
PG(n, [resampler = resample_systematic, ]threshold)</code></pre><p>Create a Particle Gibbs sampler with <code>n</code> particles.</p><p>If the algorithm for the resampling step is not specified explicitly, systematic resampling is performed if the estimated effective sample size per particle drops below 0.5.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/smc.jl#L66-L74">source</a></section></article><p>The Particle Gibbs introduced in <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> runs a sequence of conditional SMC steps where a pre-selected particle, the reference particle, is replayed and propagated through  the SMC step.</p><pre><code class="language-julia hljs">sampler = PG(nparticles)
chains = sample(model, sampler, nchains)</code></pre><p>For more detailed examples please refer to the <a href="../example/#Examples">Examples</a> page.</p><h2 id="Resampling"><a class="docs-heading-anchor" href="#Resampling">Resampling</a><a id="Resampling-1"></a><a class="docs-heading-anchor-permalink" href="#Resampling" title="Permalink"></a></h2><p>AdvancedPS implements adaptive resampling for both <a href="#AdvancedPS.PG"><code>AdvancedPS.PG</code></a> and <a href="#AdvancedPS.SMC"><code>AdvancedPS.SMC</code></a>. The following resampling schemes are implemented:</p><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.resample_multinomial" href="#AdvancedPS.resample_multinomial"><code>AdvancedPS.resample_multinomial</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_multinomial(rng, weights, n)</code></pre><p>Return a vector of <code>n</code> samples <code>x₁</code>, ..., <code>xₙ</code> from the numbers 1, ..., <code>length(weights)</code>, generated by multinomial resampling.</p><p>The new indices are sampled from the multinomial distribution with probabilities equal to <code>weights</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/resampling.jl#L23-L30">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.resample_residual" href="#AdvancedPS.resample_residual"><code>AdvancedPS.resample_residual</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_residual(rng, weights, n)</code></pre><p>Return a vector of <code>n</code> samples <code>x₁</code>, ..., <code>xₙ</code> from the numbers 1, ..., <code>length(weights)</code>, generated by residual resampling.</p><p>In residual resampling we start by duplicating all the particles whose weight is bigger than <code>1/n</code>. We copy each of these particles <span>$N_i$</span> times where</p><p><span>$N_i = \left\lfloor n w_i \right\rfloor$</span></p><p>We then duplicate the <span>$R_t = n - \sum_i N_i$</span> missing particles using multinomial resampling with the residual weights given by:</p><p><span>$\tilde{w} = w_i - \frac{N_i}{N}$</span></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/resampling.jl#L37-L52">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.resample_stratified" href="#AdvancedPS.resample_stratified"><code>AdvancedPS.resample_stratified</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_stratified(rng, weights, n)</code></pre><p>Return a vector of <code>n</code> samples <code>x₁</code>, ..., <code>xₙ</code> from the numbers 1, ..., <code>length(weights)</code>, generated by stratified resampling.</p><p>In stratified resampling <code>n</code> ordered random numbers <code>u₁</code>, ..., <code>uₙ</code> are generated, where</p><p><span>$uₖ \sim U[(k - 1) / n, k / n)$</span>.</p><p>Based on these numbers the samples <code>x₁</code>, ..., <code>xₙ</code> are selected according to the multinomial distribution defined by the normalized <code>weights</code>, i.e., <code>xᵢ = j</code> if and only if</p><p><span>$uᵢ \in \left[\sum_{s=1}^{j-1} weights_{s}, \sum_{s=1}^{j} weights_{s}\right)$</span>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/resampling.jl#L83-L97">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.resample_systematic" href="#AdvancedPS.resample_systematic"><code>AdvancedPS.resample_systematic</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_systematic(rng, weights, n)</code></pre><p>Return a vector of <code>n</code> samples <code>x₁</code>, ..., <code>xₙ</code> from the numbers 1, ..., <code>length(weights)</code>, generated by systematic resampling.</p><p>In systematic resampling a random number <span>$u \sim U[0, 1)$</span> is used to generate <code>n</code> ordered numbers <code>u₁</code>, ..., <code>uₙ</code> where</p><p><span>$uₖ = (u + k − 1) / n$</span>.</p><p>Based on these numbers the samples <code>x₁</code>, ..., <code>xₙ</code> are selected according to the multinomial distribution defined by the normalized <code>weights</code>, i.e., <code>xᵢ = j</code> if and only if</p><p><span>$uᵢ \in \left[\sum_{s=1}^{j-1} weights_{s}, \sum_{s=1}^{j} weights_{s}\right)$</span></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/resampling.jl#L133-L148">source</a></section></article><p>Each of these schemes is wrapped in a <a href="#AdvancedPS.ResampleWithESSThreshold"><code>AdvancedPS.ResampleWithESSThreshold</code></a> struct to trigger a resampling step whenever the ESS is below a certain threshold.</p><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.ResampleWithESSThreshold" href="#AdvancedPS.ResampleWithESSThreshold"><code>AdvancedPS.ResampleWithESSThreshold</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ResampleWithESSThreshold{R,T&lt;:Real}</code></pre><p>Perform resampling using <code>R</code> if the effective sample size is below <code>T</code>. By default we use <code>resample_systematic</code> with a threshold of 0.5</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/resampling.jl#L187-L192">source</a></section></article><h2 id="RNG"><a class="docs-heading-anchor" href="#RNG">RNG</a><a id="RNG-1"></a><a class="docs-heading-anchor-permalink" href="#RNG" title="Permalink"></a></h2><p>AdvancedPS replays the individual trajectories instead of storing the intermediate values. This way we can build efficient samplers.  However in order to replay the trajectories we need to reproduce most of the random numbers generated  during the execution of the program while also generating diverging traces after each resampling step.  To solve these two issues AdvancedPS uses counter-based RNG introduced in <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> and widely used in large parallel systems see  <a href="https://github.com/SciML/StochasticDiffEq.jl">StochasticDifferentialEquations</a> or <a href="https://jax.readthedocs.io/en/latest/jax-101/05-random-numbers.html?highlight=random">JAX</a> for other implementations. </p><p>Under the hood AdvancedPS is using <a href="https://github.com/JuliaRandom/Random123.jl">Random123</a> for the generators. Using counter-based RNG allows us to split generators thus creating new independent random streams. These generators are also wrapped in a <a href="#AdvancedPS.TracedRNG"><code>AdvancedPS.TracedRNG</code></a> type.  The <code>TracedRNG</code> keeps track of the keys generated at every <code>split</code> and can be reset to replay random streams.</p><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.TracedRNG" href="#AdvancedPS.TracedRNG"><code>AdvancedPS.TracedRNG</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">TracedRNG{R,N,T}</code></pre><p>Wrapped random number generator from Random123 to keep track of random streams during model evaluation</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/rng.jl#L4-L8">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.split" href="#AdvancedPS.split"><code>AdvancedPS.split</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">split(key::Integer, n::Integer=1)</code></pre><p>Split <code>key</code> into <code>n</code> new keys</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/rng.jl#L33-L37">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.load_state!" href="#AdvancedPS.load_state!"><code>AdvancedPS.load_state!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load_state!(r::TracedRNG)</code></pre><p>Load state from current model iteration. Random streams are now replayed</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/rng.jl#L43-L47">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.save_state!" href="#AdvancedPS.save_state!"><code>AdvancedPS.save_state!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">save_state!(r::TracedRNG)</code></pre><p>Add current key of the inner rng in <code>r</code> to <code>keys</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/rng.jl#L79-L83">source</a></section></article><h2 id="Internals"><a class="docs-heading-anchor" href="#Internals">Internals</a><a id="Internals-1"></a><a class="docs-heading-anchor-permalink" href="#Internals" title="Permalink"></a></h2><h3 id="Particle-Sweep"><a class="docs-heading-anchor" href="#Particle-Sweep">Particle Sweep</a><a id="Particle-Sweep-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-Sweep" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.ParticleContainer" href="#AdvancedPS.ParticleContainer"><code>AdvancedPS.ParticleContainer</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Data structure for particle filters</p><ul><li><code>effectiveSampleSize(pc :: ParticleContainer)</code>: Return the effective sample size of the particles in <code>pc</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/container.jl#L1-L4">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="AdvancedPS.sweep!" href="#AdvancedPS.sweep!"><code>AdvancedPS.sweep!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">sweep!(rng, pc::ParticleContainer, resampler)</code></pre><p>Perform a particle sweep and return an unbiased estimate of the log evidence.</p><p>The resampling steps use the given <code>resampler</code>.</p><p><strong>Reference</strong></p><p>Del Moral, P., Doucet, A., &amp; Jasra, A. (2006). Sequential monte carlo samplers. Journal of the Royal Statistical Society: Series B (Statistical Methodology), 68(3), 411-436.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/AdvancedPS.jl/blob/6c2cee380ce53ab25483e57aaaf381fbb8f31fd3/src/container.jl#L304-L315">source</a></section></article><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>John K. Salmon, Mark A. Moraes, Ron O. Dror, and David E. Shaw. 2011. Parallel random numbers: as easy as 1, 2, 3. In Proceedings of 2011 International Conference for High Performance Computing, Networking, Storage and Analysis (SC &#39;11). Association for Computing Machinery, New York, NY, USA, Article 16, 1–12. DOI:https://doi.org/10.1145/2063384.2063405</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Andrieu, Christophe, Arnaud Doucet, and Roman Holenstein. &quot;Particle Markov chain Monte Carlo methods.&quot; Journal of the Royal Statistical Society: Series B (Statistical Methodology) 72, no. 3 (2010): 269-342.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../example/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 14 July 2024 14:19">Sunday 14 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
